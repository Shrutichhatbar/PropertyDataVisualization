(function(){exports.getTotalCount=function(n,t){var i,r;r=n.db;i=r.get("aptdb");i.count({},function(n,i){t.json(i)})};exports.propertylist=function(n,t){var i,r;r=n.db;i=r.get("aptdb");i.col.aggregate([{$group:{_id:"$region",Average:{$avg:"$price"}}}],function(n,i){n&&console.log(n);console.log(i);t.json(i)})};exports.propertylistByRegionRange=function(n,t){var i,r,u,f;r=n.db;i=r.get("aptdb");f=parseInt(n.query.min);u=parseInt(n.query.max);i.col.aggregate([{$match:{price:{$gt:f,$lt:u}}},{$group:{_id:"$region",count:{$sum:1}}}],function(n,i){n&&console.log(n);console.log(i);t.json(i)})};exports.updatebyregionorfilterchange=function(n,t){var u,h,c,f,e,o,i,r,s;h=n.db;u=h.get("aptdb");o=typeof n.query.min!="undefined"&&n.query.min!==null?parseInt(n.query.min):-1;e=typeof n.query.max!="undefined"&&n.query.max!==null?parseInt(n.query.max):-1;i=typeof n.query.region!="undefined"&&n.query.region!==null?n.query.region:"all";f=typeof n.query.filter!="undefined"&&n.query.filter!==null?n.query.filter:"No Filters";r=parseInt(n.query.start);c=parseInt(n.query.end);s=parseInt(c-r);i=i==="San Francisco"?"sfc":i==="North Bay"?"nby":i==="South Bay"?"sby":i==="East Bay"?"eby":i==="Santa Cruz"?"scz":i==="Peninsula"?"pen":"all";i==="all"&&f==="No Filters"&&o===-1&&e===-1?u.find({},{limit:s,skip:r},function(n,i){t.json(i)}):i!=="all"&&f==="No Filters"?u.find({region:i,price:{$gte:o,$lte:e}},{limit:s,skip:r},function(n,i){t.json(i)}):i==="all"&&f==="No Filters"?u.find({price:{$lte:e,$gte:o}},{limit:s,skip:r},function(n,i){t.json(i)}):i!=="all"&&f==="Price Low to High"?u.find({region:i,price:{$gte:o,$lte:e}},{limit:s,skip:r,sort:{price:1}},function(n,i){t.json(i)}):i==="all"&&f==="Price Low to High"?u.find({price:{$gte:o,$lte:e}},{limit:s,skip:r,sort:{price:1}},function(n,i){t.json(i)}):i!=="all"&&f==="Price High to Low"?u.find({region:i,price:{$gte:o,$lte:e}},{limit:s,skip:r,sort:{price:-1}},function(n,i){t.json(i)}):i==="all"&&f==="Price High to Low"?u.find({price:{$lte:e,$gte:o}},{limit:s,skip:r,sort:{price:-1}},function(n,i){t.json(i)}):i!=="all"&&f==="Newest First"?u.find({region:i,price:{$gte:o,$lte:e}},{limit:s,skip:r,sort:{date:-1}},function(n,i){t.json(i)}):i==="all"&&f==="Newest First"?u.find({price:{$lte:e,$gte:o}},{limit:s,skip:r,sort:{date:-1}},function(n,i){t.json(i)}):i!=="all"&&f==="Oldest First"?(console.log("abd"),u.find({region:i,price:{$gte:o,$lte:e}},{limit:s,skip:r,sort:{date:1}},function(n,i){t.json(i)})):i==="all"&&f==="Oldest First"&&(console.log("oldall"),u.find({price:{$lte:e,$gte:o}},{limit:s,skip:r,sort:{date:1}},function(n,i){t.json(i)}))};exports.getCountOnChange=function(n,t){var r,e,u,f,i;e=n.db;r=e.get("aptdb");f=parseInt(n.query.min);u=parseInt(n.query.max);i=n.query.region;console.log(i);i=i==="San Francisco"?"sfc":i==="North Bay"?"nby":i==="South Bay"?"sby":i==="East Bay"?"eby":i==="Santa Cruz"?"scz":i==="Peninsula"?"pen":"all";i!=="all"?r.count({region:i,price:{$lte:u,$gte:f}},function(n,i){t.json(i)}):r.count({price:{$lte:u,$gte:f}},function(n,i){t.json(i)})}}).call(this)